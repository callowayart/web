{
    "size" : 0,

    "query": { "bool": {
      <% tags.each_with_index do | tag, index | %>
        "must": { "term": {  "__tags" : "<%= tag %>"  }}
        <% if index < tags.count - 1 %> , <% end %>
      <% end %>
    }},
    


    // provide our group by (aggregations in elastic search)
    "aggregations": {
        "artists": {
            "terms": { "field":   "__artist", "size": 10000   },
           
            "aggregations": {
                "uri": {
                    "terms": { 
                      "field":"uri", 
                      "size": 1   
                    }
                   
                }               
            }

        }
    }
}