{
    "size" : 1000,

    "query": { "bool": {
      <% tags.each_with_index do | tag, index | %>
        "should": { "match": {  "tags"    : { "query": "<%= tag %>", "operator": "and"  }}},
        "should": { "match": {  "artist"  : { "query": "<%= tag %>", "operator": "and"  }}},
        "should": { "match": {  "title"   : { "query": "<%= tag %>", "operator": "and"  }}},
      <% end %>

      "must_not": { "term": { "__tags" : "backendonly" }}
    }}
}
